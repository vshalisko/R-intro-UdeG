---
title: "Quercus mediciones 2025 categoricas"
author: "Viacheslav Shalsiko"
date: "`r Sys.Date()`"
output: html_document
---

### Lectura de datos

```{r}
mediciones <- read.csv("tabla_recodificada_baseR_20251203.csv",
                      skip=0, encoding="UTF-8")
mediciones <- na.omit(mediciones)
dim(mediciones)
```

### Dar formato a datos

```{r}
quant_vars <- c("L","W","LWR","LA","AVML","NVS")
bin_vars <- c("FD_B1","FD_B2","VS_B1","VS_B2","VS_B3","VS_B4",
              "PVS_B1","PVS_B2","VIS_B1","VIS_B2","AVSA_B1","AVSA_B2",
              "AVSS_B1","AVSS_B2","AVSB_B1","AVSB_B2","CVT_B1","CVT_B2",
              "CVT_B3","CVT_B4","V4_","V5_","V6_","A_",
              "TA_B1","TA_B2","TA_B3","RVS_B1","RVS_B2",
              "DD_B1","DD_B2","DD_B3","RVSD_B1","RVSD_B2",
              "M_B1","M_B2")
cat_vars <- c("RVP_","ADVS_","GVM_","FA_","EVS_")
grupo_var <- c("especies")

## Variables por excluir PVS_B1, AVSS_B1, AVSS_B2, CVT_B4, V4_, V5_, V6_, TA_B3, DD_B3
bin_vars_ok <- c("FD_B1","FD_B2","VS_B1","VS_B2","VS_B3","VS_B4",
              "PVS_B2","VIS_B1","VIS_B2","AVSA_B1","AVSA_B2",
              "AVSB_B1","AVSB_B2","CVT_B1","CVT_B2",
              "CVT_B3","A_",
              "TA_B1","TA_B2","RVS_B1","RVS_B2",
              "DD_B1","DD_B2","RVSD_B1","RVSD_B2",
              "M_B1","M_B2")



mediciones[quant_vars] <- lapply(mediciones[quant_vars], as.numeric)
mediciones[grupo_var] <- lapply(mediciones[grupo_var], as.factor)
mediciones[cat_vars] <- lapply(mediciones[cat_vars], as.factor)
mediciones[bin_vars] <- lapply(mediciones[bin_vars], as.factor)

rownames(mediciones) <- make.unique(as.character(seq_len(nrow(mediciones))))
rownames(mediciones)[duplicated(rownames(mediciones))]

summary(mediciones)
```

```{r}
par(mfrow = c(2, 4))
for (v in quant_vars) {
  qqnorm(mediciones[[v]], main = v)
  qqline(mediciones[[v]])
}
```


```{r}
bin_freq <- sapply(mediciones[bin_vars_ok], function(x) table(x) / length(x))
bin_freq
#str(bin_freq)
#knitr::kable(bin_freq)
```

```{r}
library(FactoMineR)
library(factoextra)

res.famd <- FAMD(
  mediciones[,c(quant_vars, bin_vars_ok, cat_vars)],
  ncp = 10,
  graph = TRUE
)

fviz_screeplot(res.famd, addlabels = TRUE)

# ContribuciÃ³n total
fviz_contrib(res.famd, choice = "var", axes = 1)
fviz_contrib(res.famd, choice = "var", axes = 2)
fviz_contrib(res.famd, choice = "var", axes = 3)
fviz_contrib(res.famd, choice = "var", axes = 4)

# Separar por tipo
res.famd$var$contrib
```

```{r fig.width=10}

fviz_ellipses(X=res.famd, 
              habillage=mediciones[,grupo_var],
              axes=c(1,2), geom = "point")

fviz_ellipses(X=res.famd, 
              habillage=mediciones[,grupo_var],
              axes=c(1,3), geom = "point")

fviz_ellipses(X=res.famd, 
              habillage=mediciones[,grupo_var],
              axes=c(1,4), geom = "point")

fviz_ellipses(X=res.famd, 
              habillage=mediciones[,grupo_var],
              axes=c(2,3), geom = "point")

fviz_ellipses(X=res.famd, 
              habillage=mediciones[,grupo_var],
              axes=c(2,4), geom = "point")

fviz_ellipses(X=res.famd, 
              habillage=mediciones[,grupo_var],
              axes=c(3,4), geom = "point")

#fviz_famd_ind(
#  res.famd,
#  habillage = mediciones[[grupo_var]],
#  addEllipses = TRUE,
#  ellipse.level = 0.95,
#  repel = TRUE
#)
```

